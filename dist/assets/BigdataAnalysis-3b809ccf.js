import{r as a,j as e}from"./react-472d7f6d.js";import{a as p}from"./axios-439bb627.js";import{D as A}from"./react-datepicker-c416dbf1.js";import{P as z,B as G}from"./react-chartjs-2-5b8b6642.js";import{C as H,p as J,a as Q,b as X,c as ee,d as te,L as ae,A as se}from"./chart.js-a6ea3831.js";import{a7 as m}from"./date-fns-bb67f43c.js";import"./hoist-non-react-statics-d052b204.js";import"./clsx-5a9f8d06.js";import"./@floating-ui-b504a04a.js";import"./react-dom-4df14f11.js";import"./scheduler-765c72db.js";import"./@kurkle-36ca2f10.js";H.register(J,Q,X,ee,te,ae,se);const fe=()=>{const[l,C]=a.useState(null),[o,V]=a.useState(null),[g,_]=a.useState({}),[b,T]=a.useState({}),[y,B]=a.useState(null),[j,P]=a.useState(null),[w,U]=a.useState({total:"",knownVisits:[],unknownVisits:[]}),[M,x]=a.useState(!1),[N,h]=a.useState(null),[ne,R]=a.useState([]),[le,L]=a.useState([]),[i,f]=a.useState(0),[K,F]=a.useState(!1),[$,D]=a.useState(!1),[u,S]=a.useState([]),[oe,Y]=a.useState(null),[O,k]=a.useState([]);a.useEffect(()=>{l&&o&&(I(l,o),v(l,o))},[l,o]);const I=async(t,s)=>{x(!0),h(null);try{const n=await p.get(`${{}.VITE_API_BASE_URL}/data-analysis`,{params:{startDate:m(t,"yyyy-MM-dd"),endDate:m(s,"yyyy-MM-dd")}});_(n.data)}catch(n){h("Error fetching data."),console.error("Error fetching data:",n)}finally{x(!1)}},v=async(t,s)=>{x(!0),h(null);try{const n=await p.get(`${{}.VITE_API_BASE_URL}/unknown-data-analysis`,{params:{startDate:m(t,"yyyy-MM-dd"),endDate:m(s,"yyyy-MM-dd")}});T(n.data)}catch(n){h("Error fetching unknown data."),console.error("Error fetching unknown data:",n)}finally{x(!1)}},E=async(t,s)=>{D(!0),F(!0),f(0),k([]);try{const n=s==="Known"?`${{}.VITE_API_BASE_URL}/known-images-by-date`:`${{}.VITE_API_BASE_URL}/unknown-images-by-date`,c=await p.get(n,{params:{date:t}});s==="Known"?(R(c.data),S(c.data)):(L(c.data),S(c.data))}catch(n){console.error("Error fetching images:",n)}finally{D(!1)}},W=async t=>{try{const s=await p.get(`${{}.VITE_API_BASE_URL}/names-by-date`,{params:{date:t}});console.log(s.data);const n=Array.from(new Set(s.data));k(n),Y(t)}catch(s){console.error("Error fetching names:",s)}};a.useEffect(()=>{const t=Object.values(g).reduce((r,d)=>r+d,0),s=Object.values(b).reduce((r,d)=>r+d,0),n=Object.entries(g).map(([r,d])=>({date:r,count:d})),c=Object.entries(b).map(([r,d])=>({date:r,count:d}));B({labels:["Known Data","Unknown Data"],datasets:[{data:[t||1,s||1],backgroundColor:["#64C2A6","#2D87BB"]}]}),P({labels:["Known Data","Unknown Data"],datasets:[{label:"Total Visits",data:[t,s],backgroundColor:["#FF6384","#36A2EB"],borderColor:["#FF6384","#36A2EB"],borderWidth:1}]}),U({total:`${t} KNOWN  ,    ${s} UNKNOWN`,knownVisits:n,unknownVisits:c})},[g,b]);const q=()=>{i+5<u.length&&f(t=>t+1)},Z=()=>{i-1>=0&&f(t=>t-1)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col md:flex-row w-full gap-4 p-10",children:[e.jsxs("div",{className:"bg-blue-50 shadow rounded-lg p-4 md:w-1/5 w-full flex flex-col text-center",style:{height:"400px",overflowY:"auto"},children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"DATA SUMMARY"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Start Date & Time:"}),e.jsx(A,{selected:l,onChange:t=>C(t),showTimeSelect:!0,timeFormat:"hh:mm aa",timeIntervals:15,dateFormat:"Pp",className:"w-full border rounded p-2",placeholderText:"Select Start Date & Time"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"End Date & Time:"}),e.jsx(A,{selected:o,onChange:t=>V(t),showTimeSelect:!0,timeFormat:"hh:mm aa",timeIntervals:15,dateFormat:"Pp",className:"w-full border rounded p-2",placeholderText:"Select End Date & Time"})]}),e.jsx("button",{className:"bg-blue-500 text-white py-1 px-4 font-bold rounded text-m mx-auto",onClick:()=>{I(l,o),v(l,o)},children:"Fetch Data"}),M&&e.jsx("p",{children:"Loading..."}),N&&e.jsx("p",{className:"text-yellow-500",children:N})]}),e.jsxs("div",{className:"bg-blue-50 shadow rounded-lg px-4 md:w-4/5 w-full",style:{height:"400px",overflowY:"auto"},children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Data Distribution"}),y?e.jsxs("div",{style:{width:"100%",height:"280px"},children:[e.jsx(z,{data:y,options:{plugins:{legend:{display:!0,position:"bottom"}},responsive:!0,maintainAspectRatio:!1}}),e.jsx("p",{className:"mt-2 font-bold text-xl text-center",children:w.total})]}):e.jsx("p",{children:"No data available for the selected range."})]}),e.jsxs("div",{className:"bg-blue-50 shadow rounded-lg px-4 md:w-1/2 w-full",style:{height:"400px",overflowY:"auto"},children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Data Distribution (Bar Chart)"}),j?e.jsx("div",{style:{width:"100%",height:"280px"},children:e.jsx(G,{data:j,options:{plugins:{legend:{display:!0,position:"top"}},responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}})}):e.jsx("p",{children:"No data available for the selected range."})]})]}),e.jsx("div",{className:"flex flex-col md:flex-row w-full gap-4 px-10",children:e.jsxs("table",{className:"w-full table-auto border-separate ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 hover:bg-gray-200",children:[e.jsx("th",{className:"border text-xl px-4 py-2 ",children:"Known and Unknown Visits"}),e.jsx("th",{className:"border text-xl px-4 py-2",children:"Known Visits by Date"}),e.jsx("th",{className:"border text-xl px-4 py-2",children:"Unknown Visits by Date"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"bg-green-50",children:[e.jsxs("td",{className:"border px-4 py-2",style:{height:"200px",overflowY:"auto"},children:[e.jsxs("p",{className:"mt-2 text-lg",children:[e.jsx("strong",{children:"Start Date & Time:"})," ",l?m(l,"MM/dd/yyyy, h:mm a"):"Not Selected"]}),e.jsxs("p",{className:"mt-2 text-lg",children:[e.jsx("strong",{children:"End Date & Time:"})," ",o?m(o,"MM/dd/yyyy, h:mm a"):"Not Selected"]})]}),e.jsx("td",{className:"border px-4 py-2 text-lg",style:{height:"200px",overflowY:"auto"},children:w.knownVisits.map(t=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[t.date,": ",e.jsx("span",{className:"font-bold",children:t.count})]}),e.jsx("button",{className:"bg-blue-400 hover:bg-blue-600 text-white py-1.5 px-2 text-sm rounded mb-1",onClick:()=>{E(t.date,"Known"),W(t.date)},children:"View People"})]},t.date))}),e.jsx("td",{className:"border px-4 py-2 text-lg",style:{height:"200px",overflowY:"auto"},children:w.unknownVisits.map(t=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[t.date,": ",e.jsx("span",{className:"font-bold",children:t.count})]}),e.jsx("button",{className:"bg-blue-400 hover:bg-blue-600 text-white py-1.5 px-2 text-sm rounded mb-1",onClick:()=>E(t.date,"Unknown"),children:"View People"})]},t.date))})]}),K&&e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"border px-4 py-2",children:e.jsx("div",{className:"flex justify-center items-center",children:$?e.jsx("p",{children:"Loading images..."}):e.jsx(e.Fragment,{children:u.length>0&&e.jsxs("div",{className:"flex items-center gap-4 py-4",children:[e.jsx("button",{onClick:Z,disabled:i===0,className:"bg-blue-500 text-white py-2 px-4 rounded disabled:bg-gray-400",children:"Prev"}),e.jsx("div",{className:"flex flex-wrap gap-4 py-4",children:u.slice(i,i+4).map((t,s)=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("img",{src:`data:image/jpeg;base64,${t}`,alt:"Person",className:"w-72 h-72 object-cover rounded-lg"}),e.jsx("p",{className:"text-center font-semibold mt-4 text-xl",children:O[s]})]},s))}),e.jsx("button",{onClick:q,disabled:i+1>=u.length,className:"bg-blue-500 text-white py-2 px-4 rounded disabled:bg-gray-400",children:"Next"})]})})})})})]})]})})]})};export{fe as default};
